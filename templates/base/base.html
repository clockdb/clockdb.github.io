
{% load static %}

<!-- html -->
<!DOCTYPE html>
<html lang=en>

	<!-- head -->
	<head>

		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
		<link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">

		<!-- favicon -->
		<link rel="shortcut icon" href="{% static 'clockdb/favicon.ico' %}">
		<link rel="icon" href="{% static 'clockdb/favicon.ico' %}" type="image/x-icon">

		<!-- Cropperjs -->
		<!--
		<link rel="stylesheet" href="{% static 'cropperjs/dist/cropper.min.css' %}">
		 -->

		<!-- Markdown-it -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/11.0.1/markdown-it.min.js"
			integrity="sha512-hW0KbtvDnXCHbh2UCNP/6R+oXxCKiOfm9ciuUekdGBCQF1+57bGqZAk3sAFir7PMQstyRW0UecsSc2HQotH2vg=="
			crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/default.min.css"
			integrity="sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ=="
			crossorigin="anonymous" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js"
			integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw=="
			crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/kotlin.min.js"
			integrity="sha512-8aYTnyDstX39PHxorDD+6ROknf98Vqr5KTOjwRCl/442uAVKOpCJ5wY9I3VQ6y46rdDJKYBIglIfE2+GQk8U5Q=="
			crossorigin="anonymous"></script>
		<script> hljs.initHighlightingOnLoad(); </script>

	</head>

	<body>

		<!-- header -->
		<div class="header" style="display: none">
			{% include 'base/base_css.html' %}
			{% include 'base/header.html' %}
		</div>

		<!-- user id -->
		<i id="user_id" style="display: none;">{{request.user.id}}</i>

		<!-- panel -->
		<div class="Panel">
			<div class="panelHeader">
				{% include 'base/panelHeader.html' %}
			</div>
			<div class="Control">
				{% include 'panel/control.html' %}
			</div>
			<div class="Messenger">
				{% include 'panel/messenger.html' %}
			</div>
			<div class="MessengerNotifications">
				{% include 'panel/messengerNotifications.html' %}
			</div>
			<div class="Notifications">
				{% include 'panel/notifications.html' %}
			</div>	
		</div>

		<!-- main -->
		<div class="main">

			<!-- block content -->
			<div class="content">
				{% block content %}
				{% endblock content %}

				<!-- loading -->
				<div class="loading">
					<div id="id_loading_spinner">
						<span class="d-flex flex-row mx-auto flex-grow-1 justify-content-center">
							<span class="spinner-border text-primary" role="status">
								<span class="sr-only">Loading...</span>
							</span>
						</span>
					</div>
				</div>
			</div>

			<!-- footer -->
			{% include 'base/footer.html' %}

		</div>

		<!-- collections -->
		<script src="{% static 'collections/collections.min.js' %}"></script>

		<!-- jquery -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js"
			integrity="sha512-WNLxfP/8cVYL9sj8Jnp6et0BkubLP31jhTG9vhL/F5uEZmg5wEzKoXp1kJslzPQWwPT1eyMiSxlKCgzHLOTOTQ=="
			crossorigin="anonymous"></script>

		<!-- ajax chart -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.3/Chart.min.js"></script>

		<!-- papaparse -->
		<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.1/papaparse.min.js"></script>

		<!-- bootstrap -->
		<script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>

		<!--
		<script type="module" src="{% static 'cropperjs/dist/cropper.min.js' %}"></script>
		-->

		<!-- js/onePageApp.js -->
		<script>

			console.log('js/onePageApp.js')
			
			// on load
			function onePageAppOnLoad(hideIf) {
				const user_id = document.getElementById('user_id').innerHTML
				var page = window.location.pathname.replace('/','').split('/')[1];
				if (user_id != '') {
					document.querySelectorAll('div').forEach(div => {
						hideDiv(div);
					});
					document.querySelectorAll('button').forEach(button => {
						onePageApp(button);
					})
					// φ
					if (page == 'WorkingPaper') {
						var subpage = window.location.href.replace(window.location.origin,'').split('/')[4]
						if (subpage == '') {
							subpage = 'Opinion'
						}
						showPage(subpage)
						Compile();
						ts = document.getElementById('TradingSymbol1').value;
						document.title = 'Clockdb | ' + ts + ' | '+ subpage;
						page = subpage
						history.pushState({page}, ``, `/${user_id}/WorkingPaper/${ts}/${page}/`);
					// Posts
					} else {
						// phase
						if (page == 'phase') {
							url = window.location.origin + '/'
							window.open(url, '_self');
						}
						// home
						home = [
							undefined,
							'',
							'home',
							'Home',
						]
						if (home.includes(page)) {
							try {
								a = document.getElementById('user_id').innerHTML
								if (a != 'None') {
									activeurl = window.location.href.replace(window.location.origin,'').replaceAll('/','')
									activeurlsub = window.location.href.split('/')[1]
									url = window.location.origin + '/' + a + '/Posts/'
									if (activeurl != a) {
										window.open(url, '_self');
									} else {
										page = 'Posts'
										document.title = 'Clockdb | ' + page;
										history.pushState({page}, ``, `/${user_id}/${page}/`);
										showPage(page)
									}
								}
							} catch {
								url = window.location.origin + '/login'
								window.open(url, '_self');
							}
						// others
						} else {
							document.title = 'Clockdb | ' + page;
							history.pushState({page}, ``, ``);
							showPage(page)
						}
					}
				}
			};
			
			// buttons
			function onePageApp(button) {
				button.onclick = function() {
					user_id = document.getElementById('user_id').innerHTML;
					page = this.dataset.page;
					gg = 0
					if (page != "#") {
						if (page == 'Messenger') {
							if (localStorage.Messenger == 'On') {
								Messenger('Off');
							} else {
								Messenger('On')
							}
							gg = 1
						}
						if (page == 'MessengerNotifications') {
							if (localStorage.MessengerNotifications == 'On') {
								MessengerNotifications('Off');
							} else {
								MessengerNotifications('On');
							}
							gg = 1
						}
						if (page == 'Notifications') {
							if (localStorage.Notifications == 'On') {
								Notifications('Off')
							} else {
								Notifications('On')
							}
							setGeneralNotificationsAsRead();
							gg = 1
						}
						if (page == 'SortAndOrder') {
							SortAndOrder(button.id);
							gg = 1
						}
						if (page == 'Print') {
							Print();
							gg = 1
						}
						if (page == 'UploadConfirm') {
							UploadConfirm();
							gg = 1
						}
						if (page == 'Save') {
							Save();
							gg = 1
						}
						if (page == 'Rollover') {
							Rollover();
							gg = 1
						}
						if (page == 'ClearCheckboxes') {
							ClearCheckboxes();
							gg = 1
						}
						if (page == 'OpenEditor') {
							OpenEditor();
							gg = 1
						}
						if (page == 'UnhideCheckbox') {
							UnhideCheckbox();
							gg = 1
						}
						id = this.id
						if (id.slice(id.length - 8) == 'ShortCut') {
							position = button.className
							ShortCuts(id, page, position);
							gg = 1
						}
						if (page.slice(-5) == 'Files') {
							FilesPage(page);
							gg = 1
						}
						if (page == 'ReferenceHeader') {
							thisHeader = this
							ReferenceHeaderButton(thisHeader)
							gg = 1
						}
						if (page == 'search_posts') {
							showPage('Posts');
							historyPush('Posts');
							ClearPosts();
							Posts();
							gg = 1
						}
						if (page == 'Control') {
							if (localStorage.Control == 'On') {
								Control('Off');
							} else {
								Control('On');
							}
							gg = 1
						}
						if (page == 'change_password') {
							url = window.location.origin + '/' + user_id + '/change_password/';
							window.open(url, '_self');
						}
						if (page == 'messages') {
							const user_id = document.getElementById('user_id').innerHTML
							const this_user_id = button.name.replace('messageTo','')
							redirect(page, user_id, this_user_id)
							Messenger('On');
							gg = 1
						}
						if (page == 'CloseControl') {
							Control('Off');
							gg = 1
						}
						if (page == 'CloseMessenger') {
							Messenger('Off');
							gg = 1
						}
						if (page == 'friend_request') {
							id = button.name
							classB = button.className
							if (classB == 'btn btn-primary') {
								sendFriendRequest(id)
							}
							if (classB == 'btn btn-danger') {
								cancelFriendRequest(id)
							}
							toggleButton(id, classB)
							gg = 1
						}
						if (page == 'send_message') {
							messagesSend();
							gg = 1
						}
						if (page == 'New') {
							url = window.location.origin + '/' + user_id + '/WorkingPaper/MODEL';
							window.open(url, '_self');
						}
						if (page == 'Save') {
							Save()
							gg = 1
						}
						if (page == 'Logout') {
							url = window.location.origin + '/logout';
							window.open(url, '_self');
						}
						home = [
							'',
							'Home',
						]
						if (home.includes(page)) {
							page == 'Home'
						}
						if (page == 'Home') {
							try {
								a = document.getElementById('Authenticated')
								showPage(page)
								gg = 1
							} catch {
								url = window.location.origin + '/login/'
								window.open(url, '_self');
							}
						}
						if (page == 'Posts') {
							PostsUrl()
						}
						profile = [
							'profile',
						]
						if (profile.includes(page)) {
							redirect(page, user_id)
							gg = 1
						}
						if (gg < 1) {
							showPage(page);
							historyPush(page);
							Compile();
						}
					}
				}
			};

		</script>

		<!-- js/account/account.js -->
		<script src="{% static 'js/account/account.js' %}"></script>

		<!-- base/base.js -->
		<script>

			console.log('base/base.js')
			
			// redirect
			function redirect(page, user_id, this_user_id) {
				z = 0
				b = window.location.href.replace(window.location.origin,'')
				a = b.split('/')[1]
				b = b.split('/')[2]
				if (a == user_id) {
					if (page == 'profile') {
						z = 1
					}
				} else {
					if (a == user_id) {
						z = 1
					}
				}
				if (page == 'messages') {
					onSelectFriend(this_user_id)
					Messenger('On')
				} else {
					if (z == 1) {
						showPage(page)
						historyPush(page)
					} else {
						url = window.location.origin + '/' + user_id + '/' + page;
						window.open(url, '_self');
						showPage(page)
						historyPush(page)
					}
				}
			}
			
			// history push
			function historyPush(page) {
				user_id = window.location.href.replace(window.location.origin,'');
				user_id = user_id.split('/')[1];
				a = 1
				try {
					ts = document.getElementById('TradingSymbol1').value
					w = window.location.href
					o = window.location.origin
					w = w.replace(o, '')
					o = w.split('/')[2]
				} catch {}
				try {
					if (o == 'WorkingPaper') {
						history.pushState({page}, ``, `/${user_id}/WorkingPaper/${ts}/${page}/`);
						document.title = 'Clockdb | ' + ts + ' | ' + page;
						a = 0
					}
					else {}
				} catch {}
				if (a == 1) {
					history.pushState({page}, ``, `/${user_id}/${page}/`);
					document.title = 'Clockdb | ' + page;
				}
			}
			
			// popstate

			function positionpopstate() {
				try {
					a = document.getElementById(localStorage.position)
					a.focus()
					a.select()
				} catch {}
			}

			window.onpopstate = function(event) {
				showPage(event.state.page);
				positionpopstate();
			}

			function historyBack() {
				window.history.back();
				positionpopstate();
			}

			function historyForward() {
				window.history.forward();
				positionpopstate();		
			}
			
			// showPage
			function showPage(page) {
				const loading = document.getElementById('id_loading_spinner')
				const searchBar = document.getElementById('SearchBar')
				const searchUsersBar = document.getElementById('SearchUsersBar')
				loading.style.display = 'block';
				searchBar.value = '';
				searchUsersBar.value = '';
				document.querySelectorAll('div').forEach(div => {
					hideDiv(div)
				})
				try {
					document.getElementById(page).style.display = 'block';
					window.scrollTo(0, 0)
				} catch {}
				loading.style.display = 'none';
			}
			
			// hide div
			function hideDiv(div) {
				skip = [
					// loading
					'id_loading_spinner',
					// header
					'id_chat_notification_dropdown_toggle',
					'id_chat_notifications_container',
					'id_notification_dropdown_toggle',
					'id_general_notifications_container',
					// room
					'id_chatroom_card',
					'id_room_title',
					'id_chat_log_container',
					'id_chatroom_loading_spinner_container',
					'id_chatroom_loading_spinner',
					'id_client_error_modal',
				]
				if (skip.includes(div.id)) {
				} else {
					z = 0
					try {
						a = parseInt(div.id.replace('m',''))
						if (isNaN(a)) {
							z = 1
						}
					} catch {
						z = 1
					}
					if (z == 1) {
						if (div.id != '') {
							div.style.display = 'none';
						}
					}
				}
			}
			
			// display

			function display(hideIf) {
				const user_id = document.getElementById('user_id').innerHTML
				const loading = document.getElementById('id_loading_spinner')
				loading.style.display = 'block';
				var page = window.location.pathname
				page = page.split('/')[2];
				document.getElementById('clockdbSpan').style.display = 'inline-block';
				document.getElementById('HomeSpan').style.display = 'inline-block';
				try {
					if (page != 'password_change') {
						document.getElementById('NotAuthenticated').style.display = 'inline-block';
					}
				} catch {
					document.getElementById('Authenticated').style.display = 'inline-block';
				}
				if (hideIf.includes(page)) {
				} else {
					if (page == 'WorkingPaper') {
						a = 'inline-block';
						b = 'none';
						c = 'inline-block';
					} else {
						a = 'none';
						b = 'inline-block';
						c = 'inline-block';
					}
					document.getElementById('FilesSpan').style.display = a;
					document.getElementById('GearSpan').style.display = a;
					document.getElementById('FinancialsSpan').style.display = a;
					document.getElementById('AuditSpan').style.display = a;
					document.getElementById('ValuationSpan').style.display = a;
					document.getElementById('OpinionSpan').style.display = a;
					document.getElementById('MoreSpan').style.display = a;
					//
					document.getElementById('PostsSpan').style.display = b;
					//document.getElementById('DatabaseSpan').style.display = b;
					//
					//document.getElementById('ControlSpan').style.display = c;
					//document.getElementById('MessengerNotificationsSpan').style.display = c;
					//document.getElementById('NotificationsSpan').style.display = c;
					document.getElementById('SearchBarSpan').style.display = c;
					document.getElementById('SearchUsersBarSpan').style.display = c;
					try {
						if (user_id != "{{id}}") {
							username = "{{username}}"
							username = username.toLowerCase()
							a = username + ' network'
						} else {
							a = 'My Network'
						}
						document.getElementById('SearchUsersBar').placeholder = a
						if (window.innerWidth > 799) {
							a = '80%';
						} else {
							a = '60%';
						}
						document.getElementsByClassName('clockdb')[0].style.width = a;
						document.getElementsByClassName('loading')[0].style.width = a;
					} catch {}
				}
				document.getElementById('HeaderMenu').style.display = 'block';
				document.getElementsByClassName('header')[0].style.display = 'block';
				document.getElementsByClassName('panelHeader')[0].style.display = 'block';
				loading.style.display = 'none';
			}

			function preloadCallback(src, elementId){
				var img = document.getElementById(elementId)
				img.src = src
			}

			function preloadImage(imgSrc, elementId){
				// console.log("attempting to load " + imgSrc + " on element " + elementId)
				var objImagePreloader = new Image();
				objImagePreloader.src = imgSrc;
				if(objImagePreloader.complete){
					preloadCallback(objImagePreloader.src, elementId);
					objImagePreloader.onload = function(){};
				}
				else{
					objImagePreloader.onload = function() {
						preloadCallback(objImagePreloader.src, elementId);
						//    clear onLoad, IE behaves irratically with animated gifs otherwise
						objImagePreloader.onload=function(){};
					}
				}
			}

			function validateText(str)
			{
				var md = window.markdownit({
					highlight: function (str, lang) {
						if (lang && hljs.getLanguage(lang)) {
							try {
								return '<pre class="hljs"><code>' +
									hljs.highlight(lang, str, true).value +
									'</code></pre>';
							} catch (__) {}
						}
						return '<pre class="hljs"><code>' + md.utils.escapeHtml(str) + '</code></pre>';
					},
					linkify: true,
				});
				var result = md.render(str);
				return result
			}

			function displayLoadingSpinner(isDisplayed){
				var spinner = document.getElementById("id_loading_spinner")
				if(isDisplayed){
					spinner.style.display = "block"
				}
				else{
					spinner.style.display = "none"
				}
			}

		</script>

		<!-- base/header.js -->
		<script>

			console.log('base/header.js')
			
			var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
			
			var ws_path = ws_scheme + '://' + window.location.host + ":8001";
			
			var notificationSocket = new WebSocket(ws_path);
			
			notificationSocket.onmessage = function(message) {
				var data = JSON.parse(message.data);
				//console.log(data)
				//console.log("Got general notification websocket message. " + data.general_msg_type);
				//console.log("Got chat notification websocket message. " + data.chat_msg_type);
				/*
					GENERAL NOTIFICATIONS
				*/
				// new 'general' notifications data payload
				if(data.general_msg_type == 0){
					handleGeneralNotificationsData(data['notifications'], data['new_page_number'])
				}
				// "General" Pagination exhausted. No more results.
				if(data.general_msg_type == 1){
					setGeneralPaginationExhausted()
				}
				// Refresh [newest_timestamp >= NOTIFICATIONS >= oldest_timestamp]
				if(data.general_msg_type == 2){
					refreshGeneralNotificationsData(data['notifications'])
				}
				if(data.general_msg_type == 3){
					handleNewGeneralNotificationsData(data['notifications'])
				}
				if(data.general_msg_type == 4){
					setUnreadGeneralNotificationsCount(data['count'])
				}
				if(data.general_msg_type == 5){
					updateGeneralNotificationDiv(data['notification'])
				}
				/*
					CHAT NOTIFICATIONS
				*/
				// new 'chat' notifications data payload
				if(data.chat_msg_type == 10){
					handleChatNotificationsData(data['notifications'], data['new_page_number'])
				}
				// "Chat" Pagination exhausted. No more results.
				if(data.chat_msg_type == 11){
					setChatPaginationExhausted()
				}
				// refreshed chat notifications
				if(data.chat_msg_type == 13){
					handleNewChatNotificationsData(data['notifications'])
				}
				if(data.chat_msg_type == 14){
					setChatNotificationsCount(data['count'])
				}
			}
			
			notificationSocket.onclose = function(e) {
				console.error('Notification Socket closed unexpectedly');
			};
			
			notificationSocket.onopen = function(e){
				//console.log("Notification Socket on open: " + e)
				setupGeneralNotificationsMenu()
				getFirstGeneralNotificationsPage()
				getUnreadGeneralNotificationsCount()
				setupChatNotificationsMenu()
				getFirstChatNotificationsPage()
			}
			
			notificationSocket.onerror = function(e){
				console.log('Notification Socket error', e)
			}
			
			if (notificationSocket.readyState == WebSocket.OPEN) {
				//console.log("Notification Socket OPEN complete.")
			} 
			else if (notificationSocket.readyState == WebSocket.CONNECTING){
				//console.log("Notification Socket connecting..")
			}

		</script>

		<!-- base/resize.js -->
		<script>

			console.log('base/resize.js')

			function resize(c, m, g, t) {
				a = ''
				if (c == 'none') {
					if (m == 'none') {
						if (g == 'none') {
							if (t == 'none') {
								a = '100%';
							}
						}
					} else {
						a = ''
					}
				} else {
					a = ''
				}
				if (a == '') {
					if (window.innerWidth > 799) {
						a = '80%';
					} else {
						a = '60%';
					}
				}
				document.getElementsByClassName('clockdb')[0].style.width = a;
				document.getElementsByClassName('loading')[0].style.width = a;
			}

			function innerWidthColumn() {
				var w = window.innerWidth;
				if (w < 799) {
					disp = 'none';
				} else {
					disp = '';
				}
				Columns(disp);
			}

			function Columns(disp) {
				a = document.getElementsByClassName('C2');
				for(let i = 0; i < a.length; i++) { 
					document.getElementsByClassName('C2')[i].style.display = disp;
				};
				a = document.getElementsByClassName('C3');
				for(let i = 0; i < a.length; i++) { 
					document.getElementsByClassName('C3')[i].style.display = disp;
				};
				a = document.getElementsByClassName('C4');
				for(let i = 0; i < a.length; i++) { 
					document.getElementsByClassName('C4')[i].style.display = disp;
				};
				a = document.getElementsByClassName('C5');
				for(let i = 0; i < a.length; i++) { 
					document.getElementsByClassName('C5')[i].style.display = disp;
				};
				a = document.getElementsByClassName('C6');
				for(let i = 0; i < a.length; i++) { 
					document.getElementsByClassName('C6')[i].style.display = disp;
				};
				document.getElementById('Clockφ2').style.display = disp;
				document.getElementById('Clockφ3').style.display = disp;
				document.getElementById('Clockφ4').style.display = disp;
				document.getElementById('Bridgeφ2').style.display = disp;
				document.getElementById('Bridgeφ3').style.display = disp;
				document.getElementById('Bridgeφ4').style.display = disp;
				localStorage.setItem('Column', 1)
			}

		</script>

		<!-- controlPanel/controlPanel.js -->
		<script>

			console.log('controlPanel/controlPanel.js')

			function hideIndustrySEC() {
				g = document.getElementsByName('Industry_SEC')
				for(let i = 0; i < g.length; i++) {
					g[i].style.display = 'none';
				}
			}

			function controlPanelTitles() {
				// marker
				marker = `
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
					<path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
					<path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/>
				</svg>
				`
				// Sort
				try {
					a = document.getElementById('Sort')
					a = a.options[a.selectedIndex].text
					if (a == '') {
						a = 'Sort';
					} else {
						a = marker + 'Sort by ' + a;
					}
					c = document.getElementById('SortButton')
					c.innerHTML = a;
				} catch {}
				// Order
				try {
					a = document.getElementById('Order')
					a = a.options[a.selectedIndex].text
					if (a == '') {
						a = 'Order'
					} else {
						a = marker + a;
					}
					c = document.getElementById('OrderButton')
					c.innerHTML = a;
				} catch {}
				// Industry
				try {
					a = document.getElementById('Industry')
					a = a.options[a.selectedIndex].text
					if (a == '') {
						a = 'Industry'
					} else {
						a = marker + a;
					}
					c = document.getElementById('IndustryButton')
					c.innerHTML = a;
				} catch {}
				// Region
				try {
					a = document.getElementById('Region')
					a = a.options[a.selectedIndex].text
					if (a == '') {
						a = 'Region'
					} else {
						a = marker + a;
					}
					c = document.getElementById('RegionButton')
					c.innerHTML = a;
				} catch {}
				// Period
				try {
					a = document.getElementById('Period')
					a = a.options[a.selectedIndex].text
					if (a == '') {
						a = 'Year Ending'
					} else {
						a = marker + a;
					}
					c = document.getElementById('PeriodButton')
					c.innerHTML = a;
				} catch {}
				// Work In Progress
				try {		
					a = document.getElementById('WorkInProgress')
					a = a.options[a.selectedIndex].text
					if (a == 'Include Work In Progress') {
						a = 'Include Work In Progress'
					} else {
						a = marker + a;
					}
					c = document.getElementById('WorkInProgressButton')
					c.innerHTML = a;
				} catch {}
			}

			function IndustryChange() {
				try {
					controlPanelTitles();
					hideIndustrySEC();
					e = document.getElementById('Industry').value
					e = document.getElementById(e)
					e = e.parentElement
					e = e.parentElement
					e = e.parentElement
					e.style.display = 'block';
				} catch {}
			}

			function IndustrySECChange(e) {
				id = e.id.replace('m','')
				a = document.getElementById(id)
				for(let i = 0; i < a.length; i++) {
					if (a.options[i].value == a.value) {
						gg = a.options[i].innerHTML
					}
				}
				if (gg != '') {
					gg = `
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
							<path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
							<path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/>
						</svg>
					` + gg
					id = 'IndustryButton_' + id
					document.getElementById(id).innerHTML = gg
				}
			}

			function OptionsSelection() {
				e = event.target
				a = document.getElementById(e.name)
				a.value = e.id.replace('Option', '')
				e.parentElement.style.display = 'none';
				controlPanelTitles();
				hideIndustrySEC();
				try {
					IndustryChange();
					IndustrySECChange(e);
				} catch {}
			}

			function OptionsSection(c) {
				f = c + 'OptionsSection'
				f = document.getElementsByClassName(f)[0]
				d = f.style.display
				if (d == 'none') {
					d = 'block';
				} else {
					d = 'none';
				}
				f.style.display = d;
				//
				a = document.getElementById(c).options
				//
				for(let i = 0; i < a.length; i++) {
					o = a[i].innerHTML
					if (o == '') {
						o = 'any'
					}
					option = `<button id="` + a[i].value + `Option` + `" class="` + `options` + `" name="` + c + `" onclick="OptionsSelection()">` + o + `</button>`
					optionsO = optionsO + option
				}
			}

			function SortAndOrderOptions(c) {
				optionsO = ''
				OptionsSection(c, optionsO)
				a = c + 'OptionsSection'
				a = document.getElementsByClassName(a)[0]
				a.innerHTML = optionsO
			}

			function SortAndOrder(id) {
				c = id.replace('Button','')
				if (c == 'Sort') {
					SortAndOrderOptions(c)
				}
				if (c == 'Order') {
					SortAndOrderOptions(c)
				}
				if (c == 'filterFor') {
					filterForRefresh();
				}
				if (c == 'Industry') {
					SortAndOrderOptions(c)
				}
				if (c == 'Region') {
					SortAndOrderOptions(c)
				}
				if (c == 'Period') {
					SortAndOrderOptions(c)
				}
				if (c == 'WorkInProgress') {
					WorkInProgressToggle()
				}
				c = id.slice(15)
				if (id.replace(c,'') == 'IndustryButton_') {
					SortAndOrderOptions(c)
				}
			}

			function filterForRefresh() {
				document.getElementById('Industry').value = 'any'
				document.getElementById('Region').value = 'any'
				document.getElementById('Period').value = 'any'
				controlPanelTitles();
				hideIndustrySEC();
			}

			function WorkInProgressToggle() {
				a = document.getElementById('WorkInProgress').value
				if (a == '21') {
					a = 'any';
				} else {
					a = '21';
				}
				document.getElementById('WorkInProgress').value = a;
				controlPanelTitles();
			}

			function controlPanel() {
				try {
					a = window.location.href.replace(window.location.origin,'').split('/')[2]
					if (a == 'WorkingPaper') {
						a = 'Working Paper'
						wp = 'block'
						p = 'none'
					} else {
						a = 'Posts'
						wp = 'none'
						p = 'block'
					}
					document.getElementsByClassName('controlWorkingPaper')[0].style.display = wp;
					document.getElementsByClassName('controlPosts')[0].style.display = p;
					document.getElementsByClassName('controlHeaderTitle')[0].innerHTML = a;
				} catch {}
			};

			function closePanel() {
				c = 'none'
				m = 'none'
				g = 'none'
				t = 'none'
				document.getElementsByClassName('Control')[0].style.display = c;
				document.getElementsByClassName('Messenger')[0].style.display = m;
				document.getElementsByClassName('MessengerNotifications')[0].style.display = g;
				document.getElementsByClassName('Notifications')[0].style.display = t;
				document.getElementsByClassName('clockdb')[0].style.width = '100%';
				document.getElementsByClassName('loading')[0].style.width = '100%';
				localStorage.setItem('Control', 'Off')
				localStorage.setItem('Messenger', 'Off')
				localStorage.setItem('MessengerNotifications', 'Off')
				localStorage.setItem('Notifications', 'Off')
			}

			function toggleButton(id, classB) {
				if (classB == 'btn btn-danger') {
					classA = 'btn btn-primary'
					innerHTML = 'Send Friend Request'
				} else {
					classA = 'btn btn-danger'
					innerHTML = 'Cancel Friend Request'
				}
				a = document.getElementsByName(id)[0].className = classA
				a = document.getElementsByName(id)[0].innerHTML = innerHTML
				b = document.getElementsByName(id)[1].className = classA
				a = document.getElementsByName(id)[1].innerHTML = innerHTML
			}

			function Notifications(Arg) {
				if (Arg == 'On') {
					c = 'none'
					m = 'none'
					g = 'none'
					t = 'block'
					Panel(c, m, g, t, 'Notifications')
				} else {
					closePanel()
				}
			}

			function MessengerNotifications(Arg) {
				if (Arg == 'On') {
					c = 'none'
					m = 'none'
					g = 'block'
					t = 'none'
					Panel(c, m, g, t, 'MessengerNotifications')
				} else {
					closePanel()
				}
			}

			function Messenger(Arg) {
				if (Arg == 'On') {
					c = 'none'
					m = 'block'
					g = 'none'
					t = 'none'
					Panel(c, m, g, t, 'Messenger')
				} else {
					closePanel()
				}
				messageInputFocus();
			}

			function Control(Arg) {
				if (Arg == 'On') {
					c = 'block'
					m = 'none'
					g = 'none'
					t = 'none'
					Panel(c, m, g, t, 'Control')
				} else {
					closePanel()
				}
			}

			function Panel(c, m, g, t, r) {
				z = 'border-bottom: solid #0D47A1;'
				s = 'border-bottom: solid white;'
				document.getElementsByClassName('Control')[0].style.display = c;
				document.getElementsByClassName('Messenger')[0].style.display = m;
				document.getElementsByClassName('MessengerNotifications')[0].style.display = g;
				document.getElementsByClassName('Notifications')[0].style.display = t;
				resize(c, m, g, t)
				document.getElementById('ControlButton').style = s
				document.getElementById('MessengerButton').style = s
				document.getElementById('MessengerNotificationsButton').style = s
				document.getElementById('NotificationsButton').style = s
				document.getElementById(r + 'Button').style = z
				localStorage.setItem('Control', 'Off')
				localStorage.setItem('Messenger', 'Off')
				localStorage.setItem('MessengerNotifications', 'Off')
				localStorage.setItem('Notifications', 'Off')
				localStorage.setItem(r, 'On')
			}


		</script>

		<!-- js/friend/friend.js -->
		<script>
			
			console.log('friend/friend.js')

			function onFriendRequestAccepted(){
				location.reload();
			}

			function onFriendRequestDeclined(){
				location.reload();
			}

			function triggerAcceptFriendRequest(friend_request_id){
				acceptFriendRequest(friend_request_id, onFriendRequestAccepted)
			}

			function triggerDeclineFriendRequest(friend_request_id){
				declineFriendRequest(friend_request_id, onFriendRequestDeclined)
			}

			function onFriendRemoved(){
				location.reload();
			}

			function onFriendRequestAccepted(){
				location.reload();
			}

			function onFriendRequestDeclined(){
				location.reload();
			}

			function sendFriendRequest(id){
				payload = {
					"csrfmiddlewaretoken": "{{ csrf_token }}",
					"receiver_user_id": id,
				}
				$.ajax({
					type: 'POST',
					dataType: "json",
					url: "{% url 'friend-request' %}",
					timeout: 5000,
					data: payload,
					success: function(data) {
						//console.log("SUCCESS", data)
						if(data['response'] == "Friend request sent."){
							// ui is updated
						}
						else if(data['response'] != null){
							alert(data['response'])
						}
					},
					error: function(data) {
						console.error("ERROR...", data)
						alert("Something went wrong.")
					},
					complete: function(data){}
				});
			}

			function cancelFriendRequest(id){
				payload = {
					"csrfmiddlewaretoken": "{{ csrf_token }}",
					"receiver_user_id": id,
				}
				$.ajax({
					type: 'POST',
					dataType: "json",
					url: "{% url 'friend-request-cancel' %}",
					data: payload,
					timeout: 5000,
					success: function(data) {
						//console.log("SUCCESS", data)
						if(data['response'] == "Friend request canceled."){
							// ui is updated
						}
						else if(data['response'] != null){
							alert(data['response'])
						}
					},
					error: function(data) {
						console.error("ERROR...", data)
						alert("Something went wrong.")
					},
					complete: function(data){}
				});
			}

			try {
				var removeFriendBtn = document.getElementById("id_unfriend_btn")
				if (removeFriendBtn != null){
					removeFriendBtn.addEventListener("click", function(){
						removeFriend("{{id}}", onFriendRemoved)
					})
				}
			} catch {}

			function removeFriend(id, uiUpdateFunction){
				payload = {
					"csrfmiddlewaretoken": "{{ csrf_token }}",
					"receiver_user_id": id,
				}
				$.ajax({
					type: 'POST',
					dataType: "json",
					timeout: 5000,
					url: "{% url 'remove-friend' %}",
					data: payload,
					success: function(data) {
						//console.log("SUCCESS", data)
						if(data.response == "Successfully removed that friend."){
							// UI gets updated
						}
						else if(data.response != null){
							alert(data.response)
						}
					},
					error: function(data) {
						console.error("ERROR...", data)
						alert("Something went wrong." + data)
					},
					complete: function(data){
						uiUpdateFunction()
					}
				});
			}

			function triggerAcceptFriendRequest(friend_request_id){
				acceptFriendRequest(friend_request_id, onFriendRequestAccepted)
			}

			function acceptFriendRequest(friend_request_id, uiUpdateFunction){
				var url = "{% url 'friend-request-accept' friend_request_id=53252623623632623 %}".replace("53252623623632623", friend_request_id)
				$.ajax({
					type: 'GET',
					dataType: "json",
					url: url,
					timeout: 5000,
					success: function(data) {
						//console.log("SUCCESS", data)
						if(data['response'] == "Friend request accepted."){
							// ui is updated
						}
						else if(data['response'] != null){
							alert(data['response'])
						}
					},
					error: function(data) {
						console.error("ERROR...", data)
						alert("Something went wrong: " + data)
					},
					complete: function(data){
						uiUpdateFunction()
					}
				});
			}

			function triggerDeclineFriendRequest(friend_request_id){
				declineFriendRequest(friend_request_id, onFriendRequestDeclined)
			}

			function declineFriendRequest(friend_request_id, uiUpdateFunction){
				var url = "{% url 'friend-request-decline' friend_request_id=53252623623632623 %}".replace("53252623623632623", friend_request_id)
				$.ajax({
					type: 'GET',
					dataType: "json",
					url: url,
					timeout: 5000,
					success: function(data) {
						//console.log("SUCCESS", data)
						if(data['response'] == "Friend request declined."){
							// ui is updated
						}
						else if(data['response'] != null){
							alert(data['response'])
						}
					},
					error: function(data) {
						console.error("ERROR...", data)
						alert("Something went wrong: " + data)
					},
					complete: function(data){
						uiUpdateFunction()
					}
				});
			}
				
			function friendRequestButtonsOnStart() {
				FR = "{{ friends_requests }}"
				FR = FR.replace('[','')
				FR = FR.replace(']','')
				i = 0
				id = 0
				while (id != undefined) {
					try {
						id = FR.split(', ')[i]
						document.getElementsByName(id)[0].innerHTML = 'Cancel Friend Request';
						document.getElementsByName(id)[0].id = 'id_cancel_friend_request_btn_profiles';
						document.getElementsByName(id)[0].className = 'btn btn-danger';
						document.getElementsByName(id)[1].innerHTML = 'Cancel Friend Request';
						document.getElementsByName(id)[1].id = 'id_cancel_friend_request_btn_profiles';
						document.getElementsByName(id)[1].className = 'btn btn-danger';
					} catch {}
					i = i + 1
				}
			}

		</script>

		<!-- js/messenger/messenger.js -->
		<script src="{% static 'js/messenger/messenger.js' %}"></script>

		<!-- js/messengerNotification/messengerNotification.js -->
		<script src="{% static 'js/messengerNotification/messengerNotification.js' %}"></script>

		<!-- js/network/network.js -->
		<script src="{% static 'js/network/network.js' %}"></script>

		<!-- js/notification/notification.js -->
		<script src="{% static 'js/notification/notification.js' %}"></script>

		<!-- js/posts/posts.js -->
		<script src="{% static 'js/posts/posts.js' %}"></script>

		<!-- workingPaper -->

		<!-- js/workingPaper/analysis/audit.js -->
		<script src="{% static 'js/workingPaper/analysis/audit.js' %}"></script>

		<!-- js/workingPaper/analysis/compile.js -->
		<script src="{% static 'js/workingPaper/analysis/compile.js' %}"></script>

		<!-- js/workingPaper/analysis/context.js -->
		<script src="{% static 'js/workingPaper/analysis/context.js' %}"></script>

		<!-- js/workingPaper/analysis/financials.js -->
		<script src="{% static 'js/workingPaper/analysis/financials.js' %}"></script>

		<!-- js/workingPaper/analysis/valuation.js -->
		<script src="{% static 'js/workingPaper/analysis/valuation.js' %}"></script>

		<!-- js/workingPaper/base/base.js -->
		<script src="{% static 'js/workingPaper/base/base.js' %}"></script>

		<!-- js/workingPaper/base/checkboxes.js -->
		<script src="{% static 'js/workingPaper/base/checkboxes.js' %}"></script>

		<!-- js/workingPaper/base/enter.js -->
		<script src="{% static 'js/workingPaper/base/enter.js' %}"></script>

		<!-- js/workingPaper/base/openEditor.js -->
		<script src="{% static 'js/workingPaper/base/openEditor.js' %}"></script>

		<!-- js/workingPaper/base/ref.js -->
		<script src="{% static 'js/workingPaper/base/ref.js' %}"></script>

		<!-- js/workingPaper/base/shortcuts -->
		<script src="{% static 'js/workingPaper/base/shortcuts.js' %}"></script>

		<!-- js/workingPaper/base/tabulation.js -->
		<script src="{% static 'js/workingPaper/base/tabulation.js' %}"></script>

		<!-- js/workingPaper/base/unhideRows.js -->
		<script src="{% static 'js/workingPaper/base/unhideRows.js' %}"></script>

		<!-- js/workingPaper/files/enter.js -->
		<script src="{% static 'js/workingPaper/files/enter.js' %}"></script>

		<!-- js/workingPaper/files/files.js -->
		<script src="{% static 'js/workingPaper/files/files.js' %}"></script>

		<!-- js/workingPaper/files/open.js -->
		<script src="{% static 'js/workingPaper/files/open.js' %}"></script>

		<!-- js/workingPaper/files/print.js -->
		<script src="{% static 'js/workingPaper/files/print.js' %}"></script>

		<!-- js/workingPaper/files/rollover.js -->
		<script src="{% static 'js/workingPaper/files/rollover.js' %}"></script>

		<!-- js/workingPaper/files/save.js -->
		<script src="{% static 'js/workingPaper/files/save.js' %}"></script>

		<!-- js/workingPaper/graph/linechart.js -->
		<script src="{% static 'js/workingPaper/graph/linechart.js' %}"></script>

		<!-- js/workingPaper/graph/puck.js -->
		<script src="{% static 'js/workingPaper/graph/puck.js' %}"></script>

		<!-- dom -->
		<script src="{% static 'js/dom/dom.js' %}"></script>

	</body>

</html>